<!DOCTYPE html>
<!--suppress ELSpecValidationInJSP -->
<html style="background-color: var(--surface-a)">
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:p="http://primefaces.org/ui"
>

    <h:head>
        <title>TFlow Editor</title>

        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

    </h:head>
    <h:body style="background-color: var(--surface-a)">
        <h:outputStylesheet library="css" name="tflow.css#{app.forceReloadResources}" target="head"/>
        <h:outputStylesheet library="css" name="editor.css#{app.forceReloadResources}" target="head"/>
        <h:outputScript library="js" name="editor-page.js#{app.forceReloadResources}" target="head"/>
        <h:outputScript library="js" name="sqlquery.js#{app.forceReloadResources}" target="head"/>

        <p:remoteCommand name="refreshElement" action="#{sqlQueryCtl.updateComponent}" oncomplete="tflow.postRefreshElement();"/>

        <script>console.log('-- first-line of sql query --');</script>

        <div class="flow-chart">
            <h:form id="queryForm">
                <p:outputPanel class="query-actions">
                    <p:commandButton icon="pi pi-chevron-right" iconPos="right" value="Close Query" onclick="window.parent.closeQuery();"/>
                </p:outputPanel>

                <p:outputPanel class="selectable query">
                    <input name="selectableId" type="hidden" value="#{sqlQueryCtl.query.selectableId}"/>
                    <p:remoteCommand name="update#{sqlQueryCtl.query.selectableId}" oncomplete="updateComplete('#{sqlQueryCtl.query.selectableId}')"/>
                </p:outputPanel>

                <p:tabView id="tabview" style="padding: var(--padding);margin: var(--margin);" class="query-cover">
                    <p:importEnum type="com.tflow.controller.SQLQuerySection" var="SQLQuerySection"/>
                    <p:ajax event="tabChange" listener="#{sqlQueryCtl.openSection}" update="#{sqlQueryCtl.openSectionUpdate}"/>

                    <p:tab title="#{SQLQuerySection.QUERY.title}">
                        <f:facet name="title">
                            <i class="pi #{SQLQuerySection.QUERY.icon}"/>
                            <p:outputLabel value=" #{SQLQuerySection.QUERY.title}"/>
                        </f:facet>

                        <p:divider align="left">
                            <div class="inline-flex align-items-center">
                                <i class="pi pi-pointer"/>
                                <b>Select Column</b>
                            </div>
                        </p:divider>

                        <p:outputPanel id="querytab">
                            <div class="query-panel ui-g">

                                <div class="select-table-panel ui-g-2">
                                    <div class="vertical-scroll-panel">
                                        <p:dataList value="#{sqlQueryCtl.tableList}" var="tableName">
                                            <div>#{tableName}</div>
                                        </p:dataList>
                                    </div>
                                </div>

                                <div class="select-column-panel ui-g-10">
                                    <div class="horizon-scroll-panel fit-height">
                                        <!-- TODO: Tower -->
                                        <!-- TODO: Query Table with Column List with Selected Columns -->
                                    </div>
                                </div>

                            </div>

                            <p:tabView id="queryTabView" style="padding: var(--padding);margin: var(--margin);">
                                <p:ajax event="tabChange" listener="#{sqlQueryCtl.openSection}" update="#{sqlQueryCtl.openSectionUpdate}"/>

                                <p:tab title="#{SQLQuerySection.FILTER.title}">
                                    <f:facet name="title">
                                        <i class="pi #{SQLQuerySection.FILTER.icon}"/>
                                        <p:outputLabel value=" #{SQLQuerySection.FILTER.title}"/>
                                    </f:facet>

                                    <p:divider align="left">
                                        <div class="inline-flex align-items-center">
                                            <i class="pi pi-database"/>
                                            <b>Where conditions</b>
                                        </div>
                                    </p:divider>

                                    <p:outputPanel id="filterTab">
                                        <p:dataTable value="#{sqlQueryCtl.query.filterList}" var="filter">
                                            <p:column>#{filter}</p:column>
                                        </p:dataTable>
                                    </p:outputPanel>
                                </p:tab>

                                <p:tab title="#{SQLQuerySection.SORT.title}">
                                    <f:facet name="title">
                                        <i class="pi #{SQLQuerySection.SORT.icon}"/>
                                        <p:outputLabel value=" #{SQLQuerySection.SORT.title}"/>
                                    </f:facet>

                                    <p:divider align="left">
                                        <div class="inline-flex align-items-center">
                                            <i class="pi pi-database"/>
                                            <b>Order by</b>
                                        </div>
                                    </p:divider>

                                    <p:outputPanel id="sortTab">
                                        <p:dataTable value="#{sqlQueryCtl.query.sortList}" var="sort">
                                            <p:column>#{sort}</p:column>
                                        </p:dataTable>
                                    </p:outputPanel>
                                </p:tab>
                            </p:tabView>

                        </p:outputPanel>
                    </p:tab>

                    <p:tab title="#{SQLQuerySection.SQL.title}">
                        <f:facet name="title">
                            <i class="pi #{SQLQuerySection.SQL.icon}"/>
                            <p:outputLabel value=" #{SQLQuerySection.SQL.title}"/>
                        </f:facet>

                        <p:divider align="left">
                            <div class="inline-flex align-items-center">
                                <i class="pi pi-code"/>
                                <b>Generated</b>
                            </div>
                        </p:divider>

                        <p:outputPanel id="sqlTab">
                            #{sqlQueryCtl.query}
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </h:form>
        </div>

        <script>console.log('-- last-line of sql query --');</script>
    </h:body>
</f:view>
</html>